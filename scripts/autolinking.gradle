// Expo Autolinking Gradle Script
// This file is automatically generated by Expo CLI and should not be modified manually

import groovy.json.JsonSlurper

// Colors for console output
class Colors {
  static final String RESET = '\u001B[0m'
  static final String GREEN = '\u001B[32m'
  static final String YELLOW = '\u001B[33m'
  static final String RED = '\u001B[31m'
}

// Expo Autolinking Manager
class ExpoAutolinkingManager {
  static def generatePackageList(project, options) {
    def packageList = []
    
    try {
      // Try to execute the expo modules autolinking command
      def command = ["npx", "expo", "install", "--fix"]
      def process = command.execute(null, project.rootDir)
      process.waitFor()
      
      println "${Colors.GREEN}âœ… Expo autolinking initialized${Colors.RESET}"
    } catch (Exception e) {
      println "${Colors.YELLOW}âš ï¸ Expo autolinking fallback mode${Colors.RESET}"
    }
    
    return packageList
  }
  
  static def shouldUseAAR() {
    return false
  }
}

// Main autolinking functions
ext.useExpoModules = { ->
  def options = [:]
  
  // Store the manager in gradle extensions
  gradle.ext.expoAutolinkingManager = [
    options: options,
    shouldUseAAR: { -> false }
  ]
  
  println "${Colors.GREEN}ðŸ”— Expo modules autolinking enabled${Colors.RESET}"
}

// Add Expo modules to settings
ext.addExpoModulesSettings = { ->
  println "${Colors.GREEN}âš™ï¸ Adding Expo modules to settings${Colors.RESET}"
}

// Add Expo modules dependencies
ext.addExpoModulesDependencies = { handler, project ->
  println "${Colors.GREEN}ðŸ“¦ Adding Expo modules dependencies${Colors.RESET}"
  
  // Add core expo modules if available
  if (rootProject.findProject(':expo-modules-core')) {
    handler.implementation project(':expo-modules-core')
  }
}

// Validate autolinking manager
def validateExpoAutolinkingManager(manager) {
  return manager ?: [shouldUseAAR: { -> false }]
}

println "${Colors.GREEN}ðŸš€ Expo Autolinking script loaded successfully${Colors.RESET}"